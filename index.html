<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Deepfake Detector</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #f5f5f5;
      text-align: center;
      padding: 40px;
    }

    .container {
      background-color: #1f1f1f;
      padding: 30px;
      border-radius: 10px;
      max-width: 500px;
      margin: auto;
      box-shadow: 0 0 10px #333;
    }

    h1 {
      color: #00ffd5;
    }

    input[type="file"] {
      margin-top: 15px;
    }

    #preview {
      margin-top: 20px;
      max-width: 100%;
      border: 2px solid #444;
      border-radius: 8px;
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
    }

    .loading {
      color: gold;
    }

    .real {
      color: #00ff88;
    }

    .fake {
      color: #ff3c3c;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß† Deepfake Detector</h1>
    <p>Select an image to detect if it's <b>Real</b> or <b>Fake</b>.</p>
    <input type="file" id="fileInput" accept="image/*" />
    <img id="preview" alt="Preview" />
    <div id="result">Result will appear here...</div>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const preview = document.getElementById("preview");
    const resultDiv = document.getElementById("result");

    async function callGradioAPI(base64Image, retries = 3) {
      const res = await fetch(
        "https://singhvikram848446-deep-fake-detection.hf.space/api/predict/",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            data: [base64Image]
          })
        }
      );

      const result = await res.json();

      if (result.error && retries > 0 && result.error.includes("loading")) {
        resultDiv.innerHTML = "‚è≥ Starting server... retrying in 5s.";
        await new Promise((res) => setTimeout(res, 5000));
        return await callGradioAPI(base64Image, retries - 1);
      }

      return result;
    }

    fileInput.addEventListener("change", async () => {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async () => {
        const base64Image = reader.result;
        preview.src = base64Image;
        resultDiv.innerHTML = "<span class='loading'>‚è≥ Analyzing...</span>";

        const result = await callGradioAPI(base64Image);
        console.log("API Response:", result);

        if (result && result.data && result.data.length > 0 && typeof result.data[0] === "string") {
          const label = result.data[0].toLowerCase();

          if (label.includes("fake")) {
            resultDiv.innerHTML = `<span class="fake">‚ùå FAKE</span>`;
          } else if (label.includes("real")) {
            resultDiv.innerHTML = `<span class="real">‚úÖ REAL</span>`;
          } else {
            resultDiv.innerText = `üîé Result: ${label}`;
          }
        } else {
          resultDiv.innerText = "‚ùå Could not detect. Try another image.";
        }
      };

      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
