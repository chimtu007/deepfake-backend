<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Deepfake Detector</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0e101c;
      color: #fff;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .container {
      max-width: 500px;
      margin: 50px auto;
      padding: 30px;
      background: #1e2130;
      border-radius: 15px;
      box-shadow: 0 0 20px #000;
    }

    h1 {
      margin-bottom: 10px;
    }

    input[type="file"] {
      margin-top: 20px;
    }

    #preview {
      margin-top: 20px;
      max-width: 100%;
      border: 2px solid #555;
      border-radius: 10px;
    }

    #result {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
    }

    .loading {
      color: #ffd700;
    }

    .real {
      color: #00ff99;
    }

    .fake {
      color: #ff4040;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üîç Deepfake Detector</h1>
    <p>Upload a face image to check if it's Real or Fake using AI</p>
    <input type="file" id="fileInput" accept="image/*" />
    <img id="preview" alt="Image Preview" />
    <div id="result">Result will appear here...</div>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const preview = document.getElementById("preview");
    const resultDiv = document.getElementById("result");

    async function callGradioAPI(base64Image, retries = 3) {
      const response = await fetch(
        "https://singhvikram848446-deep-fake-detection.hf.space/api/predict/",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            data: [base64Image]
          })
        }
      );

      const result = await response.json();

      if (result.error && retries > 0 && result.error.includes("loading")) {
        resultDiv.innerHTML = "‚è≥ Waking up the model... retrying in 5s.";
        await new Promise((res) => setTimeout(res, 5000));
        return await callGradioAPI(base64Image, retries - 1);
      }

      return result;
    }

    fileInput.addEventListener("change", async () => {
      const file = fileInput.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = async () => {
        const base64Image = reader.result;
        preview.src = base64Image;
        resultDiv.innerHTML = "<span class='loading'>‚è≥ Analyzing image...</span>";

        const result = await callGradioAPI(base64Image);
        console.log("API Result:", result); // DEBUG LOG

        if (result && result.data && result.data.length > 0 && typeof result.data[0] === "string") {
          const label = result.data[0].toLowerCase();

          if (label.includes("fake")) {
            resultDiv.innerHTML = `<span class="fake">‚ùå Prediction: FAKE</span>`;
          } else if (label.includes("real")) {
            resultDiv.innerHTML = `<span class="real">‚úÖ Prediction: REAL</span>`;
          } else {
            resultDiv.innerHTML = `üîç Result: ${label}`;
          }
        } else {
          resultDiv.innerHTML = "‚ùå Could not detect image. Try another one.";
        }
      };

      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
